<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>

    <meta name="description" content="天使汇 | 让靠谱的项目找到靠谱的钱 | 创业，投资，找VC就上天使汇 | 中国股权众筹第一平台" />
    <meta name="keywords" content="天使汇,创业,投资,找VC,上天使汇,中国股权众筹第一平台" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no"/>
    <meta content="yes" name="apple-touch-fullscreen"/>
    <meta content="yes" name="apple-mobile-web-app-capable"/>
    <meta content="black" name="apple-mobile-web-app-status-bar-style" />
    <meta name="author" content="http://angelcrunch.com" />
    <meta name="copyright" content="Copyright &copy;http://angelcrunch.com 版权所有" />
    <meta name="revisit-after"  content="1 days" />
    <meta content="email=no" name="format-detection" />
    <meta content="telephone=yes" name="format-detection" />

    <!--iPhone vs retina screen -->
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="touch-icon-iphone-114.png" />
    <!--iPad2 & older -->
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="touch-icon-ipad-144.png" />
    <!--iPad3 & updated  -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="touch-icon-ipad-144.png" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/vnd.microsoft.icon" />
    <link rel="Bookmark" href="/favicon.ico" />
    <link rel="canonical" href="页面权威链接，待编辑" />
    <!-- META WT -->

    <title>天使汇 | 项目列表 | 让靠谱的项目找到靠谱的钱</title>
    <link href="/static/css/wapsite/base-css.css" rel="stylesheet" />
    <link href="/static/css/wapsite/list/style.css" rel="stylesheet" />

</head>
<body>
<div class="details" ms-controller="list-info">
    <div id="header" class="head">
        <div class="logo ci-link" data-href="/"></div>
        <div class="options">
            <span></span>
            <ul class="hidden-menu">
                <li class="ci-link" data-href="http://angelcrunch.com/startup_financing">创业项目</li>
                <li class="ci-link" data-href="http://angelcrunch.com/angel">投资人</li>
            </ul>
        </div>
    </div>
    <div class="section-list">
        <div class="loading-container">
            <div class="loading"></div>
        </div>
        <a ms-if="data" ms-repeat="data" ms-href="{{window.base_protocol}}{{el.id}}.{{window.base_host}}">
            <section>
                <div class="logo"><img src="" ms-src="el.logo||''" /></div>
                <div class="summary">
                    <h3 ms-text="el.name"></h3>
                    <p ms-text="el.concept"></p>
                </div>
                <div ms-if="el.coinveststatus>40 && el.coinveststatus<80" ms-data-shit="el.coinveststatus" class="progress-container">
                    <div class="progress">
                        <div class="progress-bar progress-bar-success progress-bar-striped active reverse" role="progressbar" aria-valuenow="45" aria-valuemin="0" aria-valuemax="100" ms-css-width="{{el.finishamount/el.amount > 1 ? 100 : el.finishamount/el.amount*100}}%">
                            <span class="sr-only">{{data.finance_percent}}% Complete</span>
                        </div>
                    </div>
                    <p><em>投资意向: {{el.finishamount}}万（预融资{{el.amount}}万）</em><em class="right">剩余{{el.day}}天</em></p>
                </div>
            </section>
        </a>
    </div>
</div>
<div class="page-turn">
    <a href="#p:1" class="btn prev-page">上一页</a>
    <p><i class="current-page">0</i>/<i class="total-page">0</i></p>
    <a href="#p:2" class="btn next-page">下一页</a>
</div>
</body>
<script src="/static/js/lib/jquery-2.1.4.min.js"></script>
<script src="/static/js/wapsite/angelcrunch.jq.c.js"></script>
<script src="/static/js/wapsite/angelcrunch.cookie.jq.c.js"></script>
<script src="/static/js/wapsite/angelcrunch.app_downloadbar.jq.c.js"></script>
<script src="/static/js/lib/avalon.mobile.min.js"></script>
<script src="/static/js/wapsite/angelcrunch_base.js"></script>
<script>
    (function(){
        this.avalonVM=avalon.define("list-info", function (vm) {
            vm.data = {};
        })
    }).call(this);

    (function(){
        //页面列表属性
        this.page_config={
            perpage:10,
            pagetotal:0,
            currentpage:1,
            pageindexcache:true,
            pageindexkey:'comlist_pageindex',
            localprecachearray:[],
            localprecacheprefix:'comlist_precache_prefix'
        };
        //Dom元素
        this.$page_ele={
            page_num_current:$('.current-page'),
            page_num_all:$('.total-page'),
            btn_prev:$('.prev-page'),
            btn_next:$('.next-page'),
            loading:$(".loading-container")
        };
        //页码显示
        this.page_num_update=function(){
            $page_ele.page_num_current.html(this.page_config.currentpage);
            $page_ele.page_num_all.html(this.page_config.pagetotal);
        };
        //翻页链接更新
        this.page_btn_update=function(){
            var index=parseInt(this.page_config.currentpage),prev,next,total=parseInt(this.page_config.pagetotal);

            prev=this.base_hash.putdata({p:index>1?index-1:1});
            next=this.base_hash.putdata({p:total>=index+1?index+1:index});
            this.$page_ele.btn_prev.prop('href',prev);
            this.$page_ele.btn_next.prop('href',next);
        };
        //滚动回顶部
        this.page_scroll_top=function(){
            var t=document.body.scrollTop, s, e;
            if(t){
                e=t/(200/13);
                s=setInterval(function(){
                    t-=e;
                    if(t<0){
                        t=0;
                        clearInterval(s);
                    }
                    document.body.scrollTop=t;
                },13);
            }
        };
        //数据整理
        this.page_data_get=function(call){
            var getcache,todel,data,index=parseInt(page_config.currentpage),array=[];

            getcache=base_local_data.getdata(page_config.localprecacheprefix+this.page_config.currentpage);
            if(getcache){
                data=JSON.parse(getcache);
                call(data);
            }
            else{
                this.page_remote_data(call,index);
            }
            array.push(index);
            if(index>1){
                this.page_remote_data(function(){},index-1);
                array.push(index);
            }
            if(index<parseInt(page_config.pagetotal)){
                this.page_remote_data(function(){},index+1);
                array.push(index);
            }
            for(var i in page_config.localprecachearray){
                if(array.indexOf(page_config.localprecachearray[i])==-1){
                    base_local_data.deldata(page_config.localprecacheprefix+page_config.localprecachearray[i]);
                }
            }


        };

        //远程获取数据并保存
        this.page_remote_data=function(call,index){
            base_remote_data.ajaxjsonp(api.comlist,function(data){
                if(index){
                    if(page_config.localprecachearray.indexOf(index)==-1){
                        page_config.localprecachearray.push(index);
                    }
                    base_local_data.savedata(page_config.localprecacheprefix+index,JSON.stringify(data));
                }
                call(data);
            },{'pagesize':this.page_config.perpage,'pageindex':index});
        };
        //当前页面链接hash 绑定 页数
        this.page_current_num=function(){

            var p=base_hash.getdata('p'),cache;

            if(p){
                this.page_config.currentpage=p;
            }
            //页面初始化，无法获取hash页数，从缓存读取页数并补全链接，或首页开始
            else{
                cache=this.base_local_data.getdata(this.page_config.pageindexkey);

                if(this.page_config.pageindexcache && cache!=null){
                    this.page_config.currentpage=cache;
                }

                location.hash=this.base_hash.putdata({p:this.page_config.currentpage});

                return false;
            }

        };
        //页面处理
        this.page_core=function(){

            this.page_current_num();

            this.page_scroll_top();

            this.page_data_get(function(data){

                if(data.hasOwnProperty('list')){
                    avalonVM.data=data.list;
                }
                if(data.hasOwnProperty('total')){
                    this.page_config.pagetotal=Math.ceil(data.total/this.page_config.perpage);
                }

                //更新页码数
                this.page_num_update();
                //更新翻页连接
                this.page_btn_update();
                //存储当前页数
                this.base_local_data.savedata(this.page_config.pageindexkey,this.page_config.currentpage);
                //loading动画隐藏
                this.$page_ele.loading.hide();
            });

        };


        this.page_core();

        window.onhashchange=function(){
            this.page_core();
        };



    }).call(this);

    /*触摸移动事件事件 翻页显示与隐藏*/
    (function(){
        this.$touchele=$('.page-turn');

        this.touchsta={
            barheight:65,
            eleshow:true,
            isstart:false,
            startY:0,
            endY:0
        };
        if(typeof document.body.ontouchstart!='undefined'){
            document.body.ontouchstart=function(event){
                var touch=event.touches[0];
                if(touch){
                    touchsta.startY=touch.clientY;
                    touchsta.isstart=true;
                }
            };
            document.body.ontouchmove=function(event){
                var touch=event.touches[0],mY;
                if(touch){
                    mY=touch.clientY-touchsta.startY;
                    if(Math.abs(mY)<touchsta.barheight){
                        if(mY<0 && touchsta.eleshow){
                            $touchele.css('bottom',mY);
                        }

                        if(mY>0 && !touchsta.eleshow){
                            $touchele.css('bottom',mY-touchsta.barheight);
                        }
                    }

                }
            };
            document.body.ontouchend=function(event){
                var touch=event.changedTouches[0],endY=touch.clientY,moveabs=Math.abs(endY-touchsta.startY);
                if(moveabs>5){
                    if(endY-touchsta.startY>0 && !touchsta.eleshow){
                        if(moveabs>touchsta.barheight/2){
                            $touchele.animate({'bottom':0});
                            touchsta.eleshow=true;
                        }
                        else{
                            $touchele.animate({'bottom':-touchsta.barheight});
                            touchsta.eleshow=false;
                        }
                    }
                    if(endY-touchsta.startY<0 && touchsta.eleshow){
                        if(moveabs>touchsta.barheight/2){
                            $touchele.animate({'bottom':-touchsta.barheight});
                            touchsta.eleshow=false;
                        }
                        else{
                            $touchele.animate({'bottom':0});
                            touchsta.eleshow=true;
                        }
                    }
                }

            };

        }


    }).call(this);

</script>
</html>
